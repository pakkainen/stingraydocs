# Система дистрибуции HockeyApp

## Параметры запуска

Параметры запуска зависят от расположения файла apk, отправляемого на анализ.

Так же, существуют обязательные параметры, которые необходимо указывать при любом виде запуска:

* `url` — сетевой адрес Stingray (путь до корня без последнего «/»), при использовании cloud версии — [https://saas.stingray-mobile.ru](https://saas.stingray-mobile.ru);
* `profile_id` — id профиля, для которого проводится анализ;
* `testcase_id` — id того тест-кейса, который будет воспроизведен во время анализа; возможен запуск нескольких тест-кейсов, для этого их id перечисляются через пробел. Это необязательный параметр, если он не задан, то будет запущено сканирование в ручном режиме и через 20 секунд после запуска остановлено, а данные отправлены на анализ;
* `token` — CI/CD токен для доступа, более подробная информация приведена в разделе «[Интеграции](Интеграции)»;
* `distribution_system` — способ загрузки приложения, возможные опции: `file`, `hockeyapp`. Более подробно про них описано ниже в соответствующих разделах;
* `company_id` — идентификатор компании, в рамках которой будет осуществлено сканирование;
* `architecture_id` — опциональный параметр. Определяет идентификатор архитектуры операционной системы, на которой будет произведено сканирование;
* `nowait` — опциональный параметр, определяющий необходимость ожидания завершения сканирования. Если данный флаг установлен — скрипт не будет дожидаться завершения сканирования, а выйдет сразу же после запуска. Если флаг не стоит — скрипт будет ожидать завершения процесса анализа и формировать отчет;
* `summary_report_json_file_name` — опциональный параметр. Определяет имя JSON файла, в который выгружается информация по сканированию в формате JSON. При отсутствии параметра информация сохраняться в JSON не будет;
* `pdf_report_file_name` — опциональный параметр. Определяет имя PDF файла в который выгружается информация по сканированию в формате PDF. При отсутствии параметра PDF-отчет сохраняться не будет.

## Примеры запуска

### HockeyApp по bundle_identifier и указанной версии

Для запуска анализа приложения из системы HockeyApp:

    mdast_cli --distribution_system hockeyapp --hockey_token 18bc81146d374ba4b1182ed65e0b3aaa --bundle_id com.appsec.demo 
    --hockey_version 31337 --url "https://saas.stingray-mobile.ru" --profile_id 2 --testcase_id 3 --company_id 1 
    --architecture_id 1 --token "eyJ0eXA4OiJKA1QiLbJhcGciO5JIU4I1NiJ1..."

В результате в системе HockeyApp будет найдено приложение с идентификатором пакета `com.appsec.demo` и версией `31337`. Он будет скачан и для него будет проведен автоматизированный анализ с профилем с `id 2` и будет запущен тест-кейс с `id 3`.

### HockeyApp по public_identifier и с последней доступной версией

Для запуска анализа последней версии приложения из системы HockeyApp по его публичному идентификатору:

    mdast_cli --distribution_system hockeyapp --hockey_token 18bc81146d374ba4b1182ed65e0b3aaa 
    --public_id "1234567890abcdef1234567890abcdef" --url "https://saas.stingray-mobile.ru" --profile_id 2 
    --testcase_id 3 --company_id 1 --architecture_id 1 --token "eyJ0eXA4OiJKA1QiLbJhcGciO5JIU4I1NiJ1..."

В результате в системе HockeyApp будет найдено приложение с уникальным публичным идентификатором `1234567890abcdef1234567890abcdef` и последней доступной версией. Файл приложения будет скачен и для него будет проведен автоматизированный анализ с профилем с `id 2` и будет запущен тест-кейс с `id 3`.