# Интеграция с AppStore

  <h3>Сбор необходимых параметров</h3>
  <p><span>Интеграция с AppStore производится с помощью скрипта <a href="https://github.com/Dynamic-Mobile-Security/mdast-cli"><em><strong>mdast_scan.py</strong></em></a>. </span>Чтобы скачать приложение с AppStore, необходимо располагать учетными данными аккаунта iTunes, в котором данное приложение установлено.</p>
  <p>Для корректной работы скрипта важно, чтобы соответствующее приложение было приобретено в данном аккаунте. Приобретение приложения, даже если оно бесплатное, в обязательном порядке подтверждается одним из возможных способов (отпечаток пальца, FaceId или пароль). Проверить, приобретено ли приложение, можно в настройках аккаунта AppStore. <span>Другими словами, приложение должно быть хотя бы раз установлено на устройстве с Apple ID, который используется для интеграции.</span></p>
  <p>Для успешной авторизации с использованием аккаунта iTunes необходимо получить и сохранить код двухфакторной авторизации.</p>
  <p><span>При первом запуске скрипта с указанием адреса электронной почты и пароля вы столкнетесь с ошибкой авторизации (это ожидаемое и нормальное в данном случае поведение), при этом на ваше устройство придет код двухфакторной авторизации.</span> </p>
  <p style="text-align: center"> <img height="420" src="https://user-images.githubusercontent.com/46852358/153638449-6488cf6d-214f-44cb-8265-fe8b79b2614f.png" width="30%"/></p>
  <p>Необходимо сохранить полученный код. Теперь при запуске скрипта пароль и код двухфакторной авторизации необходимо передавать в следующем виде:</p>
  <p><code>--appstore_password2FA password2FA</code>, где:</p>
  <ul class="Disc">
    <li><code>password </code>— пароль;</li>
    <li><code>2FA</code> — код двухфакторной авторизации.</li>
  </ul>
  <p>Например, если для входа в аккаунт используется пароль <code>P@ssword</code>, а полученный код двухфакторной авторизации — <code>742877</code>, передаваемый параметр будет выглядеть следующим образом: <code>--appstore_password2FA P@ssword742877</code>.</p>
  <p>Повторное получение кода двухфакторной авторизации не потребуется в течение следующих 6 месяцев.</p>
  <p>Чтобы получить параметр <code>appstore_app_id</code>, в браузере перейдите на страницу приложения в AppStore и скопируйте параметр из URL.</p>
  <p style="text-align: center"><img height="66" src="https://user-images.githubusercontent.com/46852358/153639003-f121273a-41ac-415d-aad7-6b2789f77cee.png" width="60%"/> </p>
  <p>В данном примере <code>appstore_app_id</code> — <code>398129933</code>.</p>
  <p>При запуске скрипта указываются следующие обязательные параметры:</p>
  <ul class="Disc">
    <li><strong><code>distribution_system appstore</code></strong> — признак того, что приложение скачивается из AppStore;</li>
    <li><strong><code>appstore_app_id</code></strong> — идентификатор приложения в AppStore, который можно получить из ссылки приложения в магазине AppStore, взяв числовое значение <strong>id</strong> нужного приложения: apps.apple.com/app/id<strong>{appstore_app_id}</strong>.</li>
    <li><strong><code>appstore_apple_id</code></strong> — электронная почта аккаунта iTunes;</li>
    <li><strong><code>appstore_password2FA</code></strong> — пароль и код двухфакторной авторизации аккаунта iTunes.</li>
  </ul>
  <p>Также, используя параметр <code>appstore_file_name</code>, можно указать имя, с которым файл будет сохранен (данный параметр не является обязательным).</p>
  <p><strong>Примечание:</strong> если вы авторизовались и потеряли код двухфакторной авторизации, сессия будет оставаться активной в течение одного дня (достаточно <code>appstore_app_id</code> и пароля). Вы не сможете завершить сессию с помощью данного скрипта. Таким образом, чтобы скрипт продолжал корректно работать, необходимо вновь авторизоваться спустя 24 часа с использованием пароля и кода двухфакторной аутентификации.</p>
  <p><strong>Примечание:</strong> если при запуске сканирования возникает ошибка, связанная с неправильным apple_id, например: «Вход в App Store. Чтобы открыть «Telegram», войдите с Apple ID, с которым была произведена покупка», обратитесь в службу технической поддержки компании Stingray для согласования Apple ID, с помощью которого будет выполняться интеграция с AppStore, вам будет предложено решение этой проблемы.</p>
  <h3>Пример запуска скрипта</h3>
  <p><span>Чтобы запустить сканирование приложения, скачанного с AppStore, необходимо выполнить следующую команду:</span></p>
  <pre class="language-bash"><code class="language-bash">python mdast_cli/mdast_scan.py \
    --architecture_id 3 \
    --profile_id 1246 \
    --distribution_system appstore \
    --appstore_app_id 564177498 \
    --appstore_apple_id ubet******@icloud.com \
    --appstore_password2FA pass*******31******454 \
    --url &quot;https://saas.mobile.appsec.world&quot; \
    --company_id 2 \
    --token 5d5f6****************2d9f --appstore_file_name my_b3st_4pp
</code></pre>
  <p> </p>

</body></html>